<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AFRINETHUB â€” Live</title>

  <!-- Tailwind CDN for styling (optional, but convenient) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Minor niceties */
    html,body,#root { height: 100%; }
    body { background: #0f1724; color: #e6eef8; font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .animate-in { animation: fadeIn .18s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px) } to { opacity: 1; transform: translateY(0) } }

    /* small carousel controls styling */
    .img-control { background: rgba(15,23,36,0.6); width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; border-radius:9999px; color:#fff; transition:background .15s; }
    .img-control:hover { background: rgba(255,255,255,0.12); }
    .img-indicators { gap:6px; display:inline-flex; align-items:center; }
    .img-indicators button { width:8px; height:8px; border-radius:9999px; background: rgba(148,163,184,0.25); border: none; padding:0; }
    .img-indicators button.active { background:#f59e0b; }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- Firebase compat SDKs (simple for single-file apps) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <!-- React & ReactDOM UMD + Babel (compile JSX in-browser) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- App (compiled in-browser) -->
  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    /******************************************************************
     * IMPORTANT:
     * - This single-file app uses the Firebase "compat" libraries
     *   (loaded above) so it works easily inside one HTML file.
     *
     * - FIREBASE CONFIG: your project's config is inserted below.
     *   You already provided these values; they're used here directly.
     *
     * - SECURITY: For production, set Firestore/Storage rules so only
     *   authenticated admins can write/delete. See comments near the
     *   bottom for recommended rules and admin setup.
     ******************************************************************/

    // ---------------- FIREBASE CONFIG ----------------
    const firebaseConfig = {
      apiKey: "AIzaSyDmzzR9iOp19RbM0uY19aKzJ9T3Nm5_6-k",
      authDomain: "afrinethub.firebaseapp.com",
      projectId: "afrinethub",
      storageBucket: "afrinethub.firebasestorage.app",
      messagingSenderId: "313556528568",
      appId: "1:313556528568:web:f8b1cda91950bbe953734d",
      measurementId: "G-KCZD4HLCQ1"
    };

    let firebaseAvailable = false;
    try {
      if (firebaseConfig && firebaseConfig.apiKey) {
        firebase.initializeApp(firebaseConfig);
        firebaseAvailable = true;
      } else {
        console.warn('Firebase config missing or incomplete.');
      }
    } catch (err) {
      console.error('Firebase initialization failed', err);
      firebaseAvailable = false;
    }

    const db = firebaseAvailable ? firebase.firestore() : null;
    const storage = firebaseAvailable ? firebase.storage() : null;
    const auth = firebaseAvailable ? firebase.auth() : null;

    // ---------------- SMALL ICONS (SVG) ----------------
    const Icon = ({ children, className = "w-5 h-5", ...props }) => (
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className={className} {...props}>
        {children}
      </svg>
    );
    const ShoppingCart = (p) => <Icon {...p}><path d="M3 3h2l.4 2M7 13h10l3-8H6.4" strokeLinecap="round" strokeLinejoin="round"/><circle cx="10" cy="20" r="1" /><circle cx="18" cy="20" r="1" /></Icon>;
    const MessageCircle = (p) => <Icon {...p}><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8A8.5 8.5 0 1 1 11.5 3" strokeLinecap="round" strokeLinejoin="round" /><path d="M21 21l-5.2-3" strokeLinecap="round" strokeLinejoin="round" /></Icon>;
    const Menu = (p) => <Icon {...p}><path d="M4 6h16M4 12h16M4 18h16" strokeLinecap="round" strokeLinejoin="round" /></Icon>;
    const X = (p) => <Icon {...p}><path d="M18 6L6 18M6 6l12 12" strokeLinecap="round" strokeLinejoin="round" /></Icon>;
    const Search = (p) => <Icon {...p}><path d="M21 21l-4.35-4.35" strokeLinecap="round" strokeLinejoin="round" /><circle cx="11" cy="11" r="6" /></Icon>;
    const Plus = (p) => <Icon {...p}><path d="M12 5v14M5 12h14" strokeLinecap="round" strokeLinejoin="round" /></Icon>;
    const Trash = (p) => <Icon {...p}><path d="M3 6h18M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" strokeLinecap="round" strokeLinejoin="round"/><path d="M10 10v6M14 10v6" strokeLinecap="round" strokeLinejoin="round" /></Icon>;
    const Edit = (p) => <Icon {...p}><path d="M3 21v-3l11-11 3 3L6 21H3z" strokeLinecap="round" strokeLinejoin="round"/><path d="M14 7l3 3" strokeLinecap="round" strokeLinejoin="round"/></Icon>;
    const Lock = (p) => <Icon {...p}><rect x="3" y="11" width="18" height="10" rx="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" strokeLinecap="round" strokeLinejoin="round"/></Icon>;
    const Upload = (p) => <Icon {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" strokeLinecap="round" strokeLinejoin="round"/><path d="M17 8l-5-5-5 5M12 3v12" strokeLinecap="round" strokeLinejoin="round"/></Icon>;
    const Prev = (p) => <Icon {...p}><path d="M15 6l-6 6 6 6" strokeLinecap="round" strokeLinejoin="round" /></Icon>;
    const Next = (p) => <Icon {...p}><path d="M9 6l6 6-6 6" strokeLinecap="round" strokeLinejoin="round" /></Icon>;

    // ---------------- CONSTANTS & HELPERS ----------------
    const LOCAL_STORAGE_CART_KEY = 'afri_cart_v1';
    const OFFICIAL_WHATSAPP = '2348140813999';
    const NAIRA = 'â‚¦';
    const formatMoney = (amount) => NAIRA + Number(amount || 0).toLocaleString(undefined, { maximumFractionDigits: 0 });

    const useLocalStorageState = (key, initial) => {
      const [state, setState] = useState(() => {
        try {
          const raw = localStorage.getItem(key);
          return raw ? JSON.parse(raw) : initial;
        } catch {
          return initial;
        }
      });
      useEffect(() => {
        try { localStorage.setItem(key, JSON.stringify(state)); } catch {}
      }, [key, state]);
      return [state, setState];
    };

    // ---------------- ProductCard with carousel ----------------
    function ProductCard({ product, isAdmin, onAddToCart, onEdit, onDelete }) {
      const [idx, setIdx] = useState(0);
      const images = Array.isArray(product.images) ? product.images : [];
      const urls = images.map(i => (typeof i === 'string' ? i : (i && i.url) || '')).filter(Boolean);

      useEffect(() => { if (idx >= urls.length) setIdx(0); }, [urls.length]);

      const prev = (e) => { e.stopPropagation(); if (urls.length) setIdx(i => (i - 1 + urls.length) % urls.length); };
      const next = (e) => { e.stopPropagation(); if (urls.length) setIdx(i => (i + 1) % urls.length); };
      const goTo = (i, e) => { e && e.stopPropagation(); setIdx(i); };

      return (
        <article className="group bg-slate-900 rounded-3xl overflow-hidden border border-slate-800 relative flex flex-col shadow-xl">
          <div className="h-64 relative overflow-hidden bg-slate-800">
            <img src={urls[idx] || ''} alt={`${product.name} â€¢ ${product.brand}`} loading="lazy" className="w-full h-full object-cover transition-transform group-hover:scale-105" />
            <div className="absolute top-4 left-4">
              <span className="bg-slate-950/80 backdrop-blur-md px-3 py-1 rounded-full text-[10px] font-bold uppercase">{product.category}</span>
            </div>

            {urls.length > 1 && (
              <>
                <div className="absolute inset-y-0 left-3 flex items-center">
                  <button onClick={prev} aria-label="Previous image" className="img-control"><Prev className="w-4 h-4" /></button>
                </div>
                <div className="absolute inset-y-0 right-3 flex items-center">
                  <button onClick={next} aria-label="Next image" className="img-control"><Next className="w-4 h-4" /></button>
                </div>
                <div className="absolute bottom-3 left-1/2 -translate-x-1/2">
                  <div className="img-indicators">
                    {urls.map((_, i) => (
                      <button key={i} onClick={(e) => goTo(i, e)} className={i === idx ? 'active' : ''} aria-label={`Show image ${i+1}`} />
                    ))}
                  </div>
                </div>
              </>
            )}
          </div>

          <div className="p-6 flex flex-col flex-1">
            <h3 className="text-xl font-bold mb-1">{product.name}</h3>
            <p className="text-slate-500 text-xs font-bold uppercase tracking-widest mb-2">{product.brand}</p>
            <p className="text-slate-400 text-sm mb-4 italic line-clamp-1">"{product.description}"</p>

            <div className="flex items-center justify-between mt-auto">
              <div className="flex flex-col">
                {Number(product.oldPrice) > Number(product.price) && <span className="text-xs text-slate-500 line-through">{formatMoney(product.oldPrice)}</span>}
                <span className="text-2xl font-black text-amber-400">{formatMoney(product.price)}</span>
              </div>

              {isAdmin ? (
                <div className="flex gap-2">
                  <button onClick={() => onEdit(product)} className="p-2 bg-slate-800 text-blue-400 rounded-lg" aria-label={`Edit ${product.name}`}><Edit /></button>
                  <button onClick={() => onDelete(product.id)} className="p-2 bg-slate-800 text-red-400 rounded-lg" aria-label={`Delete ${product.name}`}><Trash /></button>
                </div>
              ) : (
                <button onClick={() => onAddToCart(product)} className="flex items-center gap-2 bg-amber-500 hover:bg-amber-400 text-slate-900 px-4 py-2 rounded-xl font-bold transition-all">
                  <ShoppingCart /> Add to Cart
                </button>
              )}
            </div>
          </div>
        </article>
      );
    }

    // ---------------- App ----------------
    function App() {
      // UI & auth
      const [isAdmin, setIsAdmin] = useState(false);
      const [showLogin, setShowLogin] = useState(false);
      const [loginEmail, setLoginEmail] = useState('');
      const [loginPassword, setLoginPassword] = useState('');
      const [activeCategory, setActiveCategory] = useState('All');
      const [isMenuOpen, setIsMenuOpen] = useState(false);
      const [searchTerm, setSearchTerm] = useState('');
      const [showUploadModal, setShowUploadModal] = useState(false);
      const [editingProduct, setEditingProduct] = useState(null);
      const fileInputRef = useRef(null);

      // products from Firestore (or empty if firebase unavailable)
      const [products, setProducts] = useState([]);
      const [cart, setCart] = useLocalStorageState(LOCAL_STORAGE_CART_KEY, []);
      const [showCart, setShowCart] = useState(false);

      // upload form state
      const [formData, setFormData] = useState({
        name: '',
        category: 'Phones',
        brand: '',
        price: '',
        oldPrice: '',
        images: [],   // mix of { path, url } or dataURL strings
        newFiles: [], // File objects to be uploaded
        description: ''
      });

      const categories = ['All', 'Cars', 'Phones', 'Laptops', 'Tablets', 'Watches'];

      // subscribe to auth state if firebase is available
      useEffect(() => {
        if (!firebaseAvailable || !auth) return;
        const unsub = auth.onAuthStateChanged(user => {
          if (user) {
            // check admins collection presence
            db.collection('admins').doc(user.uid).get().then(docSnap => {
              setIsAdmin(!!docSnap.exists);
            }).catch(err => {
              console.error('Failed to check admins collection', err);
              setIsAdmin(false);
            });
          } else {
            setIsAdmin(false);
          }
        });
        return () => unsub();
      }, []);

      // subscribe to products collection if firebase available
      useEffect(() => {
        if (!firebaseAvailable || !db) {
          console.warn('Firebase not available: products will not sync. Using empty product list until configured.');
          return;
        }
        const unsubscribe = db.collection('products').orderBy('createdAt', 'desc').onSnapshot(snap => {
          const arr = [];
          snap.forEach(doc => arr.push({ id: doc.id, ...doc.data() }));
          setProducts(arr);
        }, err => {
          console.error('Firestore products subscription error', err);
        });
        return () => unsubscribe();
      }, []);

      // sync editing product into form
      useEffect(() => {
        if (editingProduct) {
          setFormData({
            name: editingProduct.name || '',
            category: editingProduct.category || 'Phones',
            brand: editingProduct.brand || '',
            price: editingProduct.price || '',
            oldPrice: editingProduct.oldPrice || '',
            images: Array.isArray(editingProduct.images) ? editingProduct.images : [],
            newFiles: [],
            description: editingProduct.description || ''
          });
        }
      }, [editingProduct]);

      // CART helpers
      const calculateTotal = () => cart.reduce((sum, item) => sum + (Number(item.price) || 0) * (item.qty || 1), 0);

      const addToCart = (product) => {
        setCart(prev => {
          const idx = prev.findIndex(p => p.id === product.id);
          if (idx >= 0) {
            const next = [...prev];
            next[idx] = { ...next[idx], qty: (next[idx].qty || 1) + 1 };
            return next;
          }
          return [{ ...product, qty: 1 }, ...prev];
        });
        setShowCart(true);
      };

      const changeQty = (id, newQty) => {
        setCart(prev => {
          if (newQty <= 0) return prev.filter(p => p.id !== id);
          return prev.map(p => p.id === id ? { ...p, qty: newQty } : p);
        });
      };

      const removeFromCart = (id) => setCart(prev => prev.filter(p => p.id !== id));

      const handleCheckout = () => {
        const total = formatMoney(calculateTotal());
        let message = `ðŸ’¸ *NEW ORDER FROM AFRINETHUB*\n\n`;
        cart.forEach((item, index) => {
          message += `${index + 1}. *${item.name}* (${item.brand})\n   Qty: ${item.qty} â€¢ Price: ${formatMoney(item.price)}\n\n`;
        });
        message += `ðŸ’ *TOTAL AMOUNT: ${total}*\n\nPlease confirm availability for these items.`;
        window.open(`https://wa.me/${OFFICIAL_WHATSAPP}?text=${encodeURIComponent(message)}`, '_blank');
      };

      // ADMIN: sign in (email/password).
      const handleSignIn = async () => {
        if (!firebaseAvailable || !auth) {
          alert('Firebase is not configured â€” cannot sign in.');
          return;
        }
        try {
          await auth.signInWithEmailAndPassword(loginEmail, loginPassword);
          setLoginEmail(''); setLoginPassword(''); setShowLogin(false);
        } catch (err) {
          console.error('Sign-in failed', err);
          alert('Sign in failed: ' + (err.message || err));
        }
      };

      const handleSignOut = async () => {
        if (auth) await auth.signOut();
        setIsAdmin(false);
      };

      // IMAGE UPLOAD: collect File objects & previews
      const handleImageUpload = (e) => {
        const files = Array.from(e.target.files || []);
        if (files.length + (formData.images.length || 0) > 8) {
          alert('Maximum 8 images allowed');
          return;
        }
        files.forEach(file => {
          const reader = new FileReader();
          reader.onloadend = () => {
            setFormData(prev => ({
              ...prev,
              images: [...(prev.images || []), reader.result],
              newFiles: [...(prev.newFiles || []), file]
            }));
          };
          reader.readAsDataURL(file);
        });
        e.target.value = '';
      };

      const removeImage = (index) => {
        setFormData(prev => {
          const images = prev.images.filter((_, i) => i !== index);
          // trim newFiles conservatively
          const newFiles = prev.newFiles.slice(0, Math.max(0, prev.newFiles.length - (prev.images.length - index)));
          return { ...prev, images, newFiles };
        });
      };

      // SAVE PRODUCT: upload newFiles if Firebase available; persist doc
      const handleSaveProduct = async (e) => {
        e.preventDefault();
        if (!formData.images || formData.images.length === 0) {
          alert('Please upload at least one image');
          return;
        }
        if (!isAdmin) {
          alert('Only admins can save products. Sign in first.');
          return;
        }

        if (!firebaseAvailable || !db || !storage) {
          alert('Firebase not available: product will not be saved remotely. Configure Firebase or check console.');
          return;
        }

        try {
          let docRef;
          if (editingProduct && editingProduct.id) {
            docRef = db.collection('products').doc(String(editingProduct.id));
          } else {
            docRef = db.collection('products').doc();
          }

          const uploaded = [];

          // Upload newFiles (if any) and collect {path, url}
          for (let i = 0; i < (formData.newFiles || []).length; i++) {
            const file = formData.newFiles[i];
            const path = `products/${docRef.id}/${Date.now()}_${file.name}`;
            const ref = storage.ref().child(path);
            const snap = await ref.put(file);
            const url = await snap.ref.getDownloadURL();
            uploaded.push({ path, url });
          }

          // Preserve existing remote images (objects or URLs)
          const existingRemote = (formData.images || []).filter(i => {
            if (typeof i === 'string') return i.startsWith('http');
            return i && i.url;
          }).map(i => (typeof i === 'string' ? { path: null, url: i } : { path: i.path || null, url: i.url }));

          const finalImages = [...existingRemote, ...uploaded];

          const payload = {
            name: formData.name,
            category: formData.category,
            brand: formData.brand,
            price: Number(formData.price),
            oldPrice: formData.oldPrice ? Number(formData.oldPrice) : 0,
            images: finalImages,
            description: formData.description || '',
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          };

          if (!editingProduct) {
            payload.createdAt = firebase.firestore.FieldValue.serverTimestamp();
          }

          await docRef.set(payload, { merge: true });

          // clear modal
          setShowUploadModal(false);
          setEditingProduct(null);
          setFormData({
            name: '',
            category: 'Phones',
            brand: '',
            price: '',
            oldPrice: '',
            images: [],
            newFiles: [],
            description: ''
          });
        } catch (err) {
          console.error('Save product error', err);
          alert('Failed to save product: ' + (err.message || err));
        }
      };

      // Delete product: remove Firestore doc and delete storage objects by saved paths
      const handleDeleteProduct = async (id) => {
        if (!isAdmin) { alert('Only admins can delete'); return; }
        if (!confirm('Delete this item?')) return;
        if (!firebaseAvailable || !db || !storage) {
          alert('Firebase not available: cannot delete remote product.');
          return;
        }
        try {
          const docRef = db.collection('products').doc(String(id));
          const snap = await docRef.get();
          if (snap.exists) {
            const data = snap.data();
            if (Array.isArray(data.images)) {
              for (const img of data.images) {
                const path = img && img.path ? img.path : null;
                if (path) {
                  try {
                    await storage.ref().child(path).delete();
                  } catch (e) {
                    console.warn('Failed to delete storage file', path, e);
                  }
                }
              }
            }
            await docRef.delete();
          }
          // remove from cart if present
          setCart(prev => prev.filter(c => c.id !== id));
        } catch (err) {
          console.error('Delete product error', err);
          alert('Failed to delete product: ' + (err.message || err));
        }
      };

      const startEdit = (p) => { setEditingProduct(p); setShowUploadModal(true); };

      // filtering
      const filteredProducts = useMemo(() => {
        const term = searchTerm.trim().toLowerCase();
        return products.filter(p => {
          const matchesCategory = activeCategory === 'All' || p.category === activeCategory;
          if (!term) return matchesCategory;
          const hay = `${p.name} ${p.brand} ${p.description}`.toLowerCase();
          return matchesCategory && hay.includes(term);
        });
      }, [products, searchTerm, activeCategory]);

      return (
        <div className="min-h-screen">
          {/* NAV */}
          <nav className="fixed w-full z-50 bg-slate-900/80 backdrop-blur border-b border-slate-800">
            <div className="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <button onClick={() => setShowLogin(s => !s)} className={`p-2 rounded-lg ${isAdmin ? 'bg-red-500' : 'bg-amber-400 text-slate-900'}`} aria-label="Admin">
                  <ShoppingCart className="w-5 h-5" />
                </button>
                <div>
                  <div className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-amber-300 to-amber-100">AFRINETHUB</div>
                  {isAdmin && <div className="text-xs text-red-400">ADMIN ACTIVE</div>}
                </div>
              </div>

              <div className="hidden md:flex items-center gap-8 text-sm font-medium">
                {categories.map(cat => (
                  <button key={cat} onClick={() => setActiveCategory(cat)} className={`${activeCategory === cat ? 'text-amber-400' : 'text-slate-400 hover:text-white'}`} aria-pressed={activeCategory === cat}>
                    {cat}
                  </button>
                ))}

                {isAdmin && <button onClick={() => setShowUploadModal(true)} className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-500"><Plus /> New Product</button>}

                <button onClick={() => setShowCart(true)} className="relative p-2 bg-slate-800 rounded-lg border border-slate-700" aria-label="Open cart">
                  <ShoppingCart />
                  {cart.length > 0 && (
                    <span className="absolute -top-2 -right-2 bg-amber-500 text-slate-900 w-5 h-5 rounded-full text-[10px] font-bold flex items-center justify-center border-2 border-slate-950">
                      {cart.reduce((sum, i) => sum + (i.qty || 1), 0)}
                    </span>
                  )}
                </button>
              </div>

              <button className="md:hidden" onClick={() => setIsMenuOpen(!isMenuOpen)} aria-label="Toggle menu">
                {isMenuOpen ? <X /> : <Menu />}
              </button>
            </div>
          </nav>

          {/* HERO */}
          <section className="pt-32 pb-10 px-4">
            <div className="max-w-7xl mx-auto">
              <div className="bg-gradient-to-br from-slate-900 to-slate-800 rounded-[2rem] p-8 md:p-16 border border-slate-700 relative overflow-hidden">
                <div className="relative z-10 max-w-2xl">
                  <h1 className="text-4xl md:text-6xl font-bold leading-tight mb-6">Direct Sales from <span className="text-amber-400">AfriNethub</span> Global.</h1>
                  <p className="text-slate-400 text-lg mb-8">Premium Autos and the latest Tech gadgets. Quality you can trust.</p>
                  {isAdmin && <button onClick={() => setShowUploadModal(true)} className="bg-amber-500 text-slate-900 px-6 py-3 rounded-xl font-bold">Quick Upload Item</button>}
                </div>
                <div className="absolute top-0 right-0 w-1/3 h-full bg-amber-500/5 blur-[100px]" />
              </div>
            </div>
          </section>

          {/* SEARCH & CATEGORIES */}
          <section className="sticky top-20 z-30 bg-slate-950/80 backdrop-blur-md py-4 border-b border-slate-800">
            <div className="max-w-7xl mx-auto px-4 flex flex-col md:flex-row gap-4 justify-between items-center">
              <div className="relative w-full md:w-96">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 w-4 h-4" />
                <input type="text" placeholder="Search items, brands or descriptions..." className="w-full bg-slate-900 border border-slate-700 rounded-lg py-2 pl-10 pr-4 outline-none focus:border-amber-500" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
              </div>

              <div className="flex gap-2 overflow-x-auto w-full no-scrollbar">
                {categories.map(cat => (
                  <button key={cat} onClick={() => setActiveCategory(cat)} className={`px-4 py-1.5 rounded-full text-xs whitespace-nowrap ${activeCategory === cat ? 'bg-amber-500 text-slate-900 font-bold' : 'bg-slate-900 border border-slate-800 text-slate-400'}`}>
                    {cat}
                  </button>
                ))}
              </div>
            </div>
          </section>

          {/* PRODUCTS GRID */}
          <section className="py-12 px-4 max-w-7xl mx-auto">
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
              {filteredProducts.map(product => (
                <ProductCard key={product.id} product={product} isAdmin={isAdmin} onAddToCart={addToCart} onEdit={startEdit} onDelete={handleDeleteProduct} />
              ))}
            </div>
          </section>

          {/* CART SIDEBAR */}
          {showCart && (
            <div className="fixed inset-0 z-[110] flex justify-end" role="dialog" aria-label="Cart">
              <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={() => setShowCart(false)} aria-hidden="true" />
              <div className="relative w-full max-w-md bg-slate-900 h-full shadow-2xl flex flex-col animate-in slide-in-from-right duration-300">
                <div className="p-6 border-b border-slate-800 flex justify-between items-center">
                  <h2 className="text-xl font-bold flex items-center gap-2"><ShoppingCart className="text-amber-500" /> YOUR CART</h2>
                  <button onClick={() => setShowCart(false)} className="p-2 hover:bg-slate-800 rounded-full" aria-label="Close cart"><X /></button>
                </div>

                <div className="flex-1 overflow-y-auto p-6 flex flex-col gap-4">
                  {cart.length === 0 ? (
                    <div className="flex flex-col items-center justify-center h-full text-slate-500 gap-4 text-center">
                      <ShoppingCart size={48} strokeWidth={1} />
                      <p>Your cart is empty</p>
                    </div>
                  ) : cart.map(item => (
                    <div key={item.id} className="bg-slate-800/50 p-4 rounded-2xl flex gap-4 border border-slate-700/50 items-center">
                      <img src={(item.images && item.images[0] && (item.images[0].url || item.images[0])) || ''} alt={`${item.name} â€¢ ${item.brand}`} loading="lazy" className="w-16 h-16 rounded-lg object-cover" />
                      <div className="flex-1">
                        <h4 className="font-bold text-sm">{item.name}</h4>
                        <p className="text-amber-500 font-bold">{formatMoney(item.price)}</p>

                        <div className="mt-2 flex items-center gap-2">
                          <button onClick={() => changeQty(item.id, (item.qty || 1) - 1)} className="px-2 py-1 bg-slate-800 rounded-md" aria-label={`Decrease quantity of ${item.name}`}>-</button>
                          <span className="text-sm font-bold">{item.qty}</span>
                          <button onClick={() => changeQty(item.id, (item.qty || 1) + 1)} className="px-2 py-1 bg-slate-800 rounded-md" aria-label={`Increase quantity of ${item.name}`}>+</button>

                          <button onClick={() => removeFromCart(item.id)} className="ml-4 text-red-400 flex items-center gap-1 text-sm" aria-label={`Remove ${item.name} from cart`}><Trash /> Remove</button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>

                {cart.length > 0 && (
                  <div className="p-6 border-t border-slate-800 bg-slate-900">
                    <div className="flex justify-between items-center mb-6">
                      <span className="text-slate-400">Total:</span>
                      <span className="text-2xl font-black text-white">{formatMoney(calculateTotal())}</span>
                    </div>
                    <button onClick={handleCheckout} className="w-full bg-green-600 hover:bg-green-500 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-3">
                      <MessageCircle /> CHECKOUT VIA WHATSAPP
                    </button>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* ADMIN LOGIN MODAL */}
          {showLogin && (
            <div className="fixed inset-0 z-[120] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4" role="dialog" aria-label="Admin login">
              <div className="bg-slate-900 border border-slate-700 p-8 rounded-3xl w-full max-w-md shadow-2xl">
                <div className="flex justify-center mb-6">
                  <div className="bg-amber-500/20 p-4 rounded-full"><Lock className="text-amber-500 w-8 h-8" /></div>
                </div>
                <h2 className="text-2xl font-bold text-center mb-2">Admin Sign In</h2>

                <input type="email" placeholder="Admin email" value={loginEmail} onChange={e => setLoginEmail(e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-xl py-3 px-4 mb-3" />
                <input type="password" placeholder="Password" value={loginPassword} onChange={e => setLoginPassword(e.target.value)} onKeyDown={e => e.key === 'Enter' && handleSignIn()} className="w-full bg-slate-800 border border-slate-700 rounded-xl py-3 px-4 mb-4" />

                <div className="flex gap-3">
                  <button onClick={() => setShowLogin(false)} className="flex-1 py-3 text-slate-400 font-bold">Cancel</button>
                  <button onClick={handleSignIn} className="flex-1 py-3 bg-amber-500 text-slate-900 rounded-xl font-bold hover:bg-amber-400">Sign In</button>
                </div>

                <p className="text-xs text-slate-500 mt-3">Create an admin user in Firebase Console -> Authentication, then add their UID as a document in Firestore collection <code className="bg-slate-800 px-1 rounded">admins/{'{uid}'}</code>.</p>
                <p className="text-xs text-slate-500 mt-2">If Firebase isn't configured, admin features are disabled and app runs in a local-only mode.</p>
              </div>
            </div>
          )}

          {/* PRODUCT UPLOAD/EDIT MODAL */}
          {showUploadModal && (
            <div className="fixed inset-0 z-[120] flex items-center justify-center bg-black/95 p-4 overflow-y-auto" role="dialog" aria-label={editingProduct ? 'Edit product' : 'Upload product'}>
              <div className="bg-slate-900 border border-slate-700 p-6 md:p-8 rounded-3xl w-full max-w-2xl my-8">
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-2xl font-bold">{editingProduct ? 'Edit Product' : 'Upload New Product'}</h2>
                  <button onClick={() => { setShowUploadModal(false); setEditingProduct(null); }} aria-label="Close upload modal"><X /></button>
                </div>

                <form onSubmit={handleSaveProduct} className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="md:col-span-2">
                    <label className="text-xs font-bold text-slate-500 uppercase mb-2 block">Product Photos (Max 8)</label>
                    <div className="grid grid-cols-4 gap-2 mb-3">
                      {Array.isArray(formData.images) && formData.images.map((img, idx) => (
                        <div key={idx} className="aspect-square relative rounded-lg overflow-hidden border border-slate-700">
                          <img src={typeof img === 'string' ? img : (img.url || '')} alt={`Preview ${idx+1}`} className="w-full h-full object-cover" />
                          <button type="button" onClick={() => removeImage(idx)} className="absolute top-1 right-1 bg-red-500 p-1 rounded-full text-white" aria-label={`Remove image ${idx+1}`}><X className="w-3 h-3" /></button>
                        </div>
                      ))}
                      {Array.isArray(formData.images) && formData.images.length < 8 && (
                        <button type="button" onClick={() => fileInputRef.current.click()} className="aspect-square flex flex-col items-center justify-center border-2 border-dashed border-slate-700 rounded-lg hover:border-amber-500 hover:bg-amber-500/5 transition-all">
                          <Upload size={20} className="text-slate-500" />
                          <span className="text-[10px] mt-1 text-slate-500 font-bold uppercase">Add</span>
                        </button>
                      )}
                    </div>
                    <input type="file" ref={fileInputRef} onChange={handleImageUpload} accept="image/*" multiple className="hidden" />
                  </div>

                  <div className="md:col-span-2">
                    <label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Product Name</label>
                    <input required value={formData.name} onChange={e => setFormData({ ...formData, name: e.target.value })} className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3" placeholder="e.g. iPhone 16 Pro Max" />
                  </div>

                  <div>
                    <label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Category</label>
                    <select value={formData.category} onChange={e => setFormData({ ...formData, category: e.target.value })} className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3">
                      {categories.filter(c => c !== 'All').map(c => <option key={c} value={c}>{c}</option>)}
                    </select>
                  </div>

                  <div>
                    <label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Brand</label>
                    <input required value={formData.brand} onChange={e => setFormData({ ...formData, brand: e.target.value })} className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3" placeholder="e.g. Apple" />
                  </div>

                  <div>
                    <label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Selling Price ({NAIRA})</label>
                    <input required type="number" value={formData.price} onChange={e => setFormData({ ...formData, price: e.target.value })} className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3" />
                  </div>

                  <div>
                    <label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Old Price (Optional)</label>
                    <input type="number" value={formData.oldPrice} onChange={e => setFormData({ ...formData, oldPrice: e.target.value })} className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3" />
                  </div>

                  <div className="md:col-span-2">
                    <label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Description</label>
                    <textarea value={formData.description} onChange={e => setFormData({ ...formData, description: e.target.value })} className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 h-20" />
                  </div>

                  <button type="submit" className="md:col-span-2 bg-amber-500 text-slate-900 py-4 rounded-xl font-bold hover:bg-amber-400 mt-4 shadow-lg shadow-amber-500/20 transition-all">
                    {editingProduct ? 'Update Inventory' : 'Post to Catalog'}
                  </button>
                </form>
              </div>
            </div>
          )}

          {/* FOOTER */}
          <footer className="bg-slate-900 border-t border-slate-800 py-16 px-4 text-center mt-12">
            <div className="flex flex-col items-center gap-4">
              <span className="text-2xl font-bold tracking-tighter">AFRINETHUB GLOBAL</span>
              <p className="text-slate-500 text-sm">Direct High-End Deals â€¢ Based in Nigeria</p>
              <div className="flex gap-4 mt-4">
                <button className="p-2 bg-slate-800 rounded-lg" aria-label="Instagram"><svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8A8.5 8.5 0 1 1 11.5 3"/></svg></button>
                <button onClick={() => window.open(`https://wa.me/${OFFICIAL_WHATSAPP}`, '_blank')} className="p-2 bg-slate-800 rounded-lg text-green-500" aria-label="WhatsApp"><MessageCircle /></button>
              </div>
            </div>
          </footer>
        </div>
      );
    }

    // Mount safely (supports older UMD that may not have createRoot)
    const mount = () => {
      const container = document.getElementById('root');
      try {
        if (ReactDOM.createRoot) {
          ReactDOM.createRoot(container).render(React.createElement(App));
        } else {
          ReactDOM.render(React.createElement(App), container);
        }
      } catch (err) {
        console.error('Render failed', err);
        container.innerHTML = '<pre style="color:#fca5a5;padding:16px;">App failed to render. See console for details.</pre>';
      }
    };

    mount();

  </script>

  <!-- Notes & recommended Firestore/Storage rules (do NOT leave these permissive in production):
       1) Create an 'admins' collection and add a document with the admin user's UID (e.g. admins/{uid}).
       2) Firestore rules (example - public read, admin-only writes):
          service cloud.firestore {
            match /databases/{database}/documents {
              match /admins/{uid} { allow read: if request.auth != null && request.auth.uid == uid; allow write: if false; }
              match /products/{productId} {
                allow read: if true;
                allow write: if request.auth != null && exists(/databases/$(database)/documents/admins/$(request.auth.uid));
              }
              match /{document=**} { allow read: if true; allow write: if false; }
            }
          }
       3) Storage rules (admin-only write to products path):
          rules_version = '2';
          service firebase.storage {
            match /b/{bucket}/o {
              match /products/{productId}/{allPaths=**} {
                allow read: if true;
                allow write: if request.auth != null && exists(/databases/$(database)/documents/admins/$(request.auth.uid));
              }
            }
          }
       4) Create admin users in Firebase -> Authentication (email/password), then add their UID doc to admins collection.
       5) For deletions: store storage paths (we save path with each uploaded image), so deletes can use the path to remove files.
  -->

</body>
</html>