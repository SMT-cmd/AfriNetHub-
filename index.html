<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AFRINETHUB â€” Live</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html,body,#root { height: 100%; }
    body { background: #0f1724; color: #e6eef8; font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .animate-in { animation: fadeIn .18s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px) } to { opacity: 1; transform: translateY(0) } }
    .btn-disabled { opacity: 0.6; pointer-events: none; cursor: not-allowed; }
    .img-control { background: rgba(15,23,36,0.6); width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; border-radius:9999px; color:#fff; transition:background .15s; }
    .img-control:hover { background: rgba(255,255,255,0.12); }
    .img-indicators { gap:6px; display:inline-flex; align-items:center; }
    .img-indicators button { width:8px; height:8px; border-radius:9999px; background: rgba(148,163,184,0.25); border: none; padding:0; }
    .img-indicators button.active { background:#f59e0b; }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <!-- React & ReactDOM + Babel for in-browser JSX -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    // ---------- FIREBASE CONFIG ----------
    const firebaseConfig = {
      apiKey: "AIzaSyDmzzR9iOp19RbM0uY19aKzJ9T3Nm5_6-k",
      authDomain: "afrinethub.firebaseapp.com",
      projectId: "afrinethub",
      storageBucket: "afrinethub.firebasestorage.app",
      messagingSenderId: "313556528568",
      appId: "1:313556528568:web:f8b1cda91950bbe953734d",
      measurementId: "G-KCZD4HLCQ1"
    };

    let db = null;
    let storage = null;

    try {
      if (firebaseConfig && firebaseConfig.apiKey) {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        storage = firebase.storage();
        console.log('Firebase initialized');
      }
    } catch (e) {
      console.warn('Firebase init failed', e);
    }

    // ---------- ICONS ----------
    const Icon = ({ children, className = "w-5 h-5", ...props }) => (
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className={className} {...props}>
        {children}
      </svg>
    );
    const ShoppingCart = (p) => (<Icon {...p}><path d="M3 3h2l.4 2M7 13h10l3-8H6.4" strokeLinecap="round" strokeLinejoin="round"/><circle cx="10" cy="20" r="1" /><circle cx="18" cy="20" r="1" /></Icon>);
    const MessageCircle = (p) => (<Icon {...p}><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8A8.5 8.5 0 1 1 11.5 3" strokeLinecap="round" strokeLinejoin="round" /><path d="M21 21l-5.2-3" strokeLinecap="round" strokeLinejoin="round" /></Icon>);
    const Menu = (p) => (<Icon {...p}><path d="M4 6h16M4 12h16M4 18h16" strokeLinecap="round" strokeLinejoin="round" /></Icon>);
    const X = (p) => (<Icon {...p}><path d="M18 6L6 18M6 6l12 12" strokeLinecap="round" strokeLinejoin="round" /></Icon>);
    const Search = (p) => (<Icon {...p}><path d="M21 21l-4.35-4.35" strokeLinecap="round" strokeLinejoin="round" /><circle cx="11" cy="11" r="6" /></Icon>);
    const Plus = (p) => (<Icon {...p}><path d="M12 5v14M5 12h14" strokeLinecap="round" strokeLinejoin="round" /></Icon>);
    const Trash = (p) => (<Icon {...p}><path d="M3 6h18M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" strokeLinecap="round" strokeLinejoin="round"/><path d="M10 10v6M14 10v6" strokeLinecap="round" strokeLinejoin="round" /></Icon>);
    const Edit = (p) => (<Icon {...p}><path d="M3 21v-3l11-11 3 3L6 21H3z" strokeLinecap="round" strokeLinejoin="round"/><path d="M14 7l3 3" strokeLinecap="round" strokeLinejoin="round"/></Icon>);
    const Lock = (p) => (<Icon {...p}><rect x="3" y="11" width="18" height="10" rx="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" strokeLinecap="round" strokeLinejoin="round"/></Icon>);
    const Upload = (p) => (<Icon {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" strokeLinecap="round" strokeLinejoin="round"/><path d="M17 8l-5-5-5 5M12 3v12" strokeLinecap="round" strokeLinejoin="round"/></Icon>);
    const Prev = (p) => (<Icon {...p}><path d="M15 6l-6 6 6 6" strokeLinecap="round" strokeLinejoin="round" /></Icon>);
    const Next = (p) => (<Icon {...p}><path d="M9 6l6 6-6 6" strokeLinecap="round" strokeLinejoin="round" /></Icon>);

    // ---------- constants & helpers ----------
    const LOCAL_STORAGE_CART_KEY = 'afri_cart_v1';
    const OFFICIAL_WHATSAPP = '2348140813999';
    const NAIRA = 'â‚¦';
    const ADMIN_PLAIN_PASSCODE = '#112AfriNethubnodeyplay112#'; // plain passcode per request

    const formatMoney = (amount) => NAIRA + Number(amount || 0).toLocaleString(undefined, { maximumFractionDigits: 0 });

    const useLocalStorageState = (key, initial) => {
      const [state, setState] = useState(() => {
        try {
          const raw = localStorage.getItem(key);
          return raw ? JSON.parse(raw) : initial;
        } catch {
          return initial;
        }
      });
      useEffect(() => {
        try { localStorage.setItem(key, JSON.stringify(state)); } catch {}
      }, [key, state]);
      return [state, setState];
    };

    // ---------- ProductCard ----------
    function ProductCard({ product, isAdmin, onAddToCart, onEdit, onDelete }) {
      const [idx, setIdx] = useState(0);
      const images = product.images || [];
      const urls = images.map(i => (typeof i === 'string' ? i : (i.url || '')));
      useEffect(() => { if (idx >= urls.length) setIdx(0); }, [urls.length]);

      return (
        <article className="group bg-slate-900 rounded-2xl overflow-hidden border border-slate-800 relative flex flex-col">
          <div className="h-64 bg-slate-800 relative overflow-hidden">
            <img src={urls[idx]} alt={`${product.name} â€¢ ${product.brand}`} loading="lazy" className="w-full h-full object-cover transition-transform group-hover:scale-105" />
            <div className="absolute top-4 left-4">
              <span className="bg-slate-950/80 px-3 py-1 rounded-full text-xs font-bold uppercase">{product.category}</span>
            </div>

            {urls.length > 1 && (
              <>
                <div className="absolute inset-y-0 left-3 flex items-center">
                  <button onClick={(e)=>{ e.stopPropagation(); setIdx(i => (i - 1 + urls.length) % urls.length); }} aria-label="Previous" className="img-control"><Prev className="w-4 h-4" /></button>
                </div>
                <div className="absolute inset-y-0 right-3 flex items-center">
                  <button onClick={(e)=>{ e.stopPropagation(); setIdx(i => (i + 1) % urls.length); }} aria-label="Next" className="img-control"><Next className="w-4 h-4" /></button>
                </div>
              </>
            )}
          </div>

          <div className="p-6 flex flex-col flex-1">
            <h3 className="text-xl font-bold mb-1">{product.name}</h3>
            <p className="text-slate-500 text-xs font-bold uppercase tracking-widest mb-2">{product.brand}</p>
            <p className="text-slate-400 text-sm mb-4 italic line-clamp-1">"{product.description}"</p>

            <div className="flex items-center justify-between mt-auto">
              <div>
                {product.oldPrice > product.price && <div className="text-xs text-slate-500 line-through">{formatMoney(product.oldPrice)}</div>}
                <div className="text-2xl font-black text-amber-400">{formatMoney(product.price)}</div>
              </div>

              {isAdmin ? (
                <div className="flex gap-2">
                  <button onClick={() => onEdit(product)} className="p-2 bg-slate-800 rounded text-blue-400"><Edit /></button>
                  <button onClick={() => onDelete(product.id)} className="p-2 bg-slate-800 rounded text-red-400"><Trash /></button>
                </div>
              ) : (
                <button onClick={() => onAddToCart(product)} className="flex items-center gap-2 bg-amber-400 text-slate-900 px-4 py-2 rounded font-bold">
                  <ShoppingCart /> Add to Cart
                </button>
              )}
            </div>
          </div>
        </article>
      );
    }

    // ---------- App (with isAdminAllowed & isAdminActive) ----------
    function App() {
      // Persisted "allowed" flag (device remembered) and session "active" flag (controls UI)
      const [isAdminAllowed, setIsAdminAllowed] = useState(() => {
        try { return localStorage.getItem('afri_is_admin') === '1'; } catch { return false; }
      });
      const [isAdminActive, setIsAdminActive] = useState(false); // session-level activation
      const [showLogin, setShowLogin] = useState(false);
      const [loginCode, setLoginCode] = useState('');
      const [activeCategory, setActiveCategory] = useState('All');
      const [isMenuOpen, setIsMenuOpen] = useState(false);
      const [searchTerm, setSearchTerm] = useState('');
      const [showUploadModal, setShowUploadModal] = useState(false);
      const [editingProduct, setEditingProduct] = useState(null);
      const fileInputRef = useRef(null);

      // products & cart
      const [products, setProducts] = useState([]);
      const [cart, setCart] = useLocalStorageState(LOCAL_STORAGE_CART_KEY, []);
      const [showCart, setShowCart] = useState(false);

      // form
      const [formData, setFormData] = useState({ name:'', category:'Phones', brand:'', price:'', oldPrice:'', images:[], newFiles:[], description:'' });
      const [isSaving, setIsSaving] = useState(false);

      // long-press refs/settings
      const longPressTimerRef = useRef(null);
      const longPressDuration = 700; // ms to trigger long-press

      // local defaults (used if Firestore not available)
      const localDefaults = [
        { id: 1, name: 'Toyota Camry 2022 XLE', category: 'Cars', brand: 'Toyota', price: 28500000, oldPrice: 30000000, images: ['https://images.unsplash.com/photo-1621007947382-bb3c3994e3fb?w=1200&q=60'], description: 'Foreign Used, Full Option' },
        { id: 2, name: 'iPhone 16 Pro Max', category: 'Phones', brand: 'Apple', price: 2150000, oldPrice: 2300000, images: ['https://images.unsplash.com/photo-1727116195101-72f85bc67858?w=1200&q=60'], description: '256GB, Desert Titanium' }
      ];

      // Load products: prefer Firestore realtime, fallback to local
      useEffect(() => {
        if (db) {
          const unsub = db.collection('products').orderBy('createdAt','desc').onSnapshot(snap => {
            const arr = [];
            snap.forEach(d => arr.push({ id: d.id, ...d.data() }));
            setProducts(arr);
          }, err => {
            console.error('Firestore listen error', err);
            setProducts(localDefaults);
          });
          return () => unsub();
        } else {
          const persisted = localStorage.getItem('afri_products_v3');
          if (persisted) {
            try { setProducts(JSON.parse(persisted)); } catch { setProducts(localDefaults); }
          } else setProducts(localDefaults);
        }
      }, []);

      // persist local products when Firestore not used
      useEffect(() => {
        if (!db) {
          try { localStorage.setItem('afri_products_v3', JSON.stringify(products)); } catch {}
        }
      }, [products]);

      // editing -> populate form
      useEffect(() => {
        if (editingProduct) {
          setFormData({
            name: editingProduct.name || '',
            category: editingProduct.category || 'Phones',
            brand: editingProduct.brand || '',
            price: editingProduct.price || '',
            oldPrice: editingProduct.oldPrice || '',
            images: editingProduct.images || [],
            newFiles: [],
            description: editingProduct.description || ''
          });
        }
      }, [editingProduct]);

      // cleanup long-press timer on unmount
      useEffect(() => {
        return () => { if (longPressTimerRef.current) clearTimeout(longPressTimerRef.current); };
      }, []);

      // CART helpers
      const calculateTotal = () => cart.reduce((sum, item) => sum + (Number(item.price) || 0) * (item.qty || 1), 0);

      const addToCart = (product) => {
        setCart(prev => {
          const idx = prev.findIndex(p => p.id === product.id);
          if (idx >= 0) {
            const next = [...prev]; next[idx] = { ...next[idx], qty: next[idx].qty + 1 }; return next;
          }
          return [{ ...product, qty: 1 }, ...prev];
        });
        setShowCart(true);
      };

      const changeQty = (id, newQty) => setCart(prev => {
        if (newQty <= 0) return prev.filter(p => p.id !== id);
        return prev.map(p => p.id === id ? { ...p, qty: newQty } : p);
      });

      const removeFromCart = (id) => setCart(prev => prev.filter(p => p.id !== id));

      const handleCheckout = () => {
        const total = formatMoney(calculateTotal());
        let message = `ðŸ’¸ *NEW ORDER FROM AFRINETHUB*\n\n`;
        cart.forEach((item, index) => {
          message += `${index + 1}. *${item.name}* (${item.brand})\n   Qty: ${item.qty} â€¢ Price: ${formatMoney(item.price)}\n\n`;
        });
        message += `ðŸ’ *TOTAL AMOUNT: ${total}*\n\nPlease confirm availability for these items.`;
        window.open(`https://wa.me/${OFFICIAL_WHATSAPP}?text=${encodeURIComponent(message)}`, '_blank');
      };

      // ---------- long-press handlers ----------
      function startLongPress(e) {
        // Prevent default to avoid context menu on long touch
        if (e && e.preventDefault) e.preventDefault();
        if (longPressTimerRef.current) clearTimeout(longPressTimerRef.current);
        longPressTimerRef.current = setTimeout(() => {
          longPressTimerRef.current = null;
          handleLongPress();
        }, longPressDuration);
      }

      function cancelLongPress() {
        if (longPressTimerRef.current) {
          clearTimeout(longPressTimerRef.current);
          longPressTimerRef.current = null;
        }
      }

      function handleLongPress() {
        // If session already active, open admin panel directly
        if (isAdminActive) {
          setShowUploadModal(true);
        } else {
          // require access code (even if device is allowed previously)
          setShowLogin(true);
        }
      }

      // ---------- Access code login ----------
      const handleAccessCodeLogin = () => {
        if (!loginCode || loginCode.trim() === '') { alert('Enter access code'); return; }
        if (loginCode.trim() === ADMIN_PLAIN_PASSCODE) {
          try { localStorage.setItem('afri_is_admin','1'); } catch {}
          setIsAdminAllowed(true);   // remember device is allowed
          setIsAdminActive(true);    // activate this session so UI appears
          setShowLogin(false);
          setLoginCode('');
          // optionally open upload immediately:
          setShowUploadModal(true);
        } else {
          alert('Wrong access code.');
        }
      };

      // Sign out should deactivate session only (keeps allowed flag so device remains recognized).
      const handleSignOut = () => {
        setIsAdminActive(false);
        // optionally: to remove remembered device uncomment the two lines below:
        // try { localStorage.removeItem('afri_is_admin'); } catch {}
        // setIsAdminAllowed(false);
      };

      // ---------- Image upload ----------
      const handleImageUpload = (e) => {
        const files = Array.from(e.target.files || []);
        if (files.length + formData.images.length > 8) { alert('Maximum 8 images allowed'); return; }

        files.forEach(file => {
          const reader = new FileReader();
          reader.onloadend = () => {
            setFormData(prev => ({ ...prev, images: [...prev.images, reader.result], newFiles: [...prev.newFiles, file] }));
          };
          reader.readAsDataURL(file);
        });
        e.target.value = '';
      };

      const removeImage = (index) => {
        setFormData(prev => {
          const images = prev.images.filter((_, i) => i !== index);
          const newFiles = prev.newFiles.slice(0, Math.max(0, prev.newFiles.length - (prev.images.length - index)));
          return { ...prev, images, newFiles };
        });
      };

      // ---------- Save product (requires isAdminActive) ----------
      const handleSaveProduct = async (e) => {
        if (e && e.preventDefault) e.preventDefault();
        if (!formData.images || formData.images.length === 0) { alert('Please upload at least one image'); return; }
        if (!isAdminActive) { alert('Only active admin sessions can save products. Long-press the admin icon and enter the access code.'); return; }

        setIsSaving(true);
        try {
          if (db && storage) {
            let docRef;
            if (editingProduct && editingProduct.id) docRef = db.collection('products').doc(String(editingProduct.id));
            else docRef = db.collection('products').doc();

            const uploaded = [];
            for (let i = 0; i < (formData.newFiles || []).length; i++) {
              const file = formData.newFiles[i];
              const path = `products/${docRef.id}/${Date.now()}_${file.name}`;
              const ref = storage.ref().child(path);
              const snap = await ref.put(file);
              const url = await snap.ref.getDownloadURL();
              uploaded.push({ path, url });
            }

            const existingRemote = (formData.images || []).filter(i => {
              if (typeof i === 'string') return i.startsWith('http');
              return i && i.url;
            }).map(i => (typeof i === 'string' ? { path: null, url: i } : { path: i.path || null, url: i.url }));

            const finalImages = [...existingRemote, ...uploaded];

            const payload = {
              name: formData.name,
              category: formData.category,
              brand: formData.brand,
              price: Number(formData.price),
              oldPrice: formData.oldPrice ? Number(formData.oldPrice) : 0,
              images: finalImages,
              description: formData.description || '',
              updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            if (!editingProduct) payload.createdAt = firebase.firestore.FieldValue.serverTimestamp();

            await docRef.set(payload, { merge: true });
            alert('Product saved to catalog.');
          } else {
            const normalized = { ...formData, id: editingProduct ? editingProduct.id : Date.now(), price: Number(formData.price), oldPrice: formData.oldPrice ? Number(formData.oldPrice) : 0 };
            if (editingProduct) setProducts(prev => prev.map(p => p.id === editingProduct.id ? normalized : p));
            else setProducts(prev => [normalized, ...prev]);
            alert('Product saved locally (Firestore not configured).');
          }

          setShowUploadModal(false);
          setEditingProduct(null);
          setFormData({ name:'', category:'Phones', brand:'', price:'', oldPrice:'', images:[], newFiles:[], description:'' });
        } catch (err) {
          console.error('Save product error', err);
          let msg = err && err.message ? err.message : String(err);
          if (msg.toLowerCase().includes('permission')) msg = 'Permission denied â€” check Firestore/Storage rules.';
          alert('Failed to save product: ' + msg);
        } finally {
          setIsSaving(false);
        }
      };

      // ---------- Delete product (requires isAdminActive) ----------
      const handleDeleteProduct = async (id) => {
        if (!isAdminActive) { alert('Only active admin sessions can delete products. Long-press admin icon and enter the access code.'); return; }
        if (!confirm('Delete this item?')) return;

        try {
          if (db && storage) {
            const docRef = db.collection('products').doc(String(id));
            const snap = await docRef.get();
            if (snap.exists) {
              const data = snap.data();
              if (Array.isArray(data.images)) {
                for (const img of data.images) {
                  const path = img && img.path ? img.path : null;
                  if (path) {
                    try { await storage.ref().child(path).delete(); } catch (e) { console.warn('Failed to delete storage path', path, e); }
                  }
                }
              }
            }
            await db.collection('products').doc(String(id)).delete();
          } else {
            setProducts(prev => prev.filter(p => p.id !== id));
          }
          setCart(prev => prev.filter(c => c.id !== id));
        } catch (err) {
          console.error('Delete error', err);
          alert('Failed to delete product');
        }
      };

      const startEdit = (p) => { setEditingProduct(p); setShowUploadModal(true); };

      // filtering
      const filteredProducts = useMemo(() => {
        const term = searchTerm.trim().toLowerCase();
        return products.filter(p => {
          const matchesCategory = activeCategory === 'All' || p.category === activeCategory;
          if (!term) return matchesCategory;
          const hay = `${p.name} ${p.brand} ${p.description}`.toLowerCase();
          return matchesCategory && hay.includes(term);
        });
      }, [products, searchTerm, activeCategory]);

      // Render
      return (
        <div className="min-h-screen">
          {/* NAV */}
          <nav className="fixed w-full z-50 bg-slate-900/80 backdrop-blur border-b border-slate-800">
            <div className="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
              <div className="flex items-center gap-3">
                {/* Cart logo is visible to visitors â€” long-press to open admin access */}
                <button
                  onPointerDown={startLongPress}
                  onPointerUp={cancelLongPress}
                  onPointerCancel={cancelLongPress}
                  onPointerLeave={cancelLongPress}
                  onTouchStart={startLongPress}
                  onTouchEnd={cancelLongPress}
                  onContextMenu={(e)=>e.preventDefault()}
                  className={`p-2 rounded-lg ${isAdminActive ? 'bg-red-500' : 'bg-amber-400 text-slate-900'}`}
                  aria-label="Admin (press & hold to open access)"
                  title="Press and hold to open admin access"
                >
                  <ShoppingCart className="w-5 h-5" />
                </button>

                <div>
                  <div className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-amber-300 to-amber-100">AFRINETHUB</div>
                  <div className="flex items-center gap-2">
                    {isAdminActive && <div className="text-xs text-red-400">ADMIN ACTIVE</div>}
                    {isAdminActive && (
                      <button onClick={handleSignOut} className="text-xs text-slate-400 hover:text-white">Sign out</button>
                    )}
                  </div>
                </div>
              </div>

              <div className="hidden md:flex items-center gap-4">
                {['All','Cars','Phones','Laptops','Tablets','Watches'].map(cat => (
                  <button key={cat} onClick={()=>setActiveCategory(cat)} className={`text-sm px-3 py-1 rounded ${activeCategory===cat?'bg-amber-500 text-slate-900':'text-slate-400 hover:text-white'}`}>{cat}</button>
                ))}

                {isAdminActive && <button onClick={()=>setShowUploadModal(true)} className="bg-green-600 px-3 py-2 rounded text-white flex items-center gap-2"><Plus/> New</button>}

                <button onClick={()=>setShowCart(true)} className="relative p-2 bg-slate-800 rounded">
                  <ShoppingCart />
                  {cart.length > 0 && (<span className="absolute -top-2 -right-2 bg-amber-400 text-slate-900 w-5 h-5 rounded-full text-[10px] font-bold flex items-center justify-center border-2 border-slate-900">{cart.reduce((s,i)=>s+(i.qty||1),0)}</span>)}
                </button>
              </div>

              <button className="md:hidden p-2" onClick={()=>setIsMenuOpen(!isMenuOpen)} aria-label="Toggle">
                {isMenuOpen ? <X /> : <Menu />}
              </button>
            </div>
          </nav>

          {/* HERO */}
          <header className="pt-28 pb-10 px-4">
            <div className="max-w-7xl mx-auto">
              <div className="rounded-2xl p-8 md:p-16 bg-gradient-to-br from-slate-900 to-slate-800 border border-slate-700">
                <h1 className="text-3xl md:text-5xl font-bold">Direct Sales from <span className="text-amber-400">AfriNethub</span> Global</h1>
                <p className="text-slate-400 mt-4">Premium Autos & latest tech. Quality you can trust.</p>
                {isAdminActive && <button onClick={()=>setShowUploadModal(true)} className="mt-6 bg-amber-400 text-slate-900 px-4 py-2 rounded">Quick Upload Item</button>}
              </div>
            </div>
          </header>

          {/* SEARCH / CATS */}
          <section className="sticky top-20 z-30 bg-slate-950/80 backdrop-blur-md py-4 border-b border-slate-800">
            <div className="max-w-7xl mx-auto px-4 flex flex-col md:flex-row gap-4 items-center">
              <div className="relative w-full md:w-96">
                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"><Search /></div>
                <input value={searchTerm} onChange={e=>setSearchTerm(e.target.value)} placeholder="Search items, brands or description..." className="w-full bg-slate-900 border border-slate-700 rounded-lg py-2 pl-10 pr-4" />
              </div>

              <div className="flex gap-2 overflow-x-auto w-full no-scrollbar">
                {['All','Cars','Phones','Laptops','Tablets','Watches'].map(cat => (
                  <button key={cat} onClick={()=>setActiveCategory(cat)} className={`px-4 py-1.5 rounded-full text-xs ${activeCategory===cat?'bg-amber-500 text-slate-900 font-bold':'bg-slate-900 border border-slate-800 text-slate-400'}`}>{cat}</button>
                ))}
              </div>
            </div>
          </section>

          {/* GRID */}
          <main className="py-12 px-4 max-w-7xl mx-auto">
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
              {filteredProducts.map(product => (
                <ProductCard key={product.id} product={product} isAdmin={isAdminActive} onAddToCart={addToCart} onEdit={startEdit} onDelete={handleDeleteProduct} />
              ))}
            </div>
          </main>

          {/* CART */}
          {showCart && (
            <div className="fixed inset-0 z-40 flex justify-end" role="dialog" aria-label="Cart">
              <div className="absolute inset-0 bg-black/60" onClick={()=>setShowCart(false)} aria-hidden="true"></div>
              <aside className="relative w-full max-w-md h-full bg-slate-900 border-l border-slate-800 p-6 flex flex-col">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-bold flex items-center gap-2"><ShoppingCart /> YOUR CART</h2>
                  <button onClick={()=>setShowCart(false)} aria-label="Close"><X /></button>
                </div>
                <div className="flex-1 overflow-y-auto py-2">
                  {cart.length === 0 ? (
                    <div className="text-center text-slate-500 py-12"><div className="mb-4"><ShoppingCart className="w-10 h-10" /></div>Your cart is empty</div>
                  ) : cart.map(item => (
                    <div key={item.id} className="bg-slate-800/50 p-4 rounded-xl mb-3 flex gap-3 items-center">
                      <img src={(item.images && item.images[0] && (item.images[0].url || item.images[0])) || ''} alt={`${item.name} â€¢ ${item.brand}`} className="w-16 h-16 object-cover rounded" />
                      <div className="flex-1">
                        <div className="font-bold text-sm">{item.name}</div>
                        <div className="text-amber-400 font-bold">{formatMoney(item.price)}</div>
                        <div className="mt-2 flex items-center gap-2">
                          <button onClick={()=>changeQty(item.id,(item.qty||1)-1)} className="px-2 py-1 bg-slate-800 rounded">-</button>
                          <div className="font-bold text-sm">{item.qty}</div>
                          <button onClick={()=>changeQty(item.id,(item.qty||1)+1)} className="px-2 py-1 bg-slate-800 rounded">+</button>
                          <button onClick={()=>removeFromCart(item.id)} className="ml-3 text-red-400 text-sm flex items-center gap-1"><Trash /> Remove</button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
                {cart.length > 0 && (
                  <div className="mt-4">
                    <div className="flex justify-between items-center mb-4"><div className="text-slate-400">Total:</div><div className="text-2xl font-black">{formatMoney(calculateTotal())}</div></div>
                    <button onClick={handleCheckout} className="w-full bg-green-600 py-3 rounded text-white flex items-center justify-center gap-3"><MessageCircle /> CHECKOUT VIA WHATSAPP</button>
                  </div>
                )}
              </aside>
            </div>
          )}

          {/* ADMIN LOGIN modal (shown after long-press) */}
          {showLogin && (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4" onClick={() => setShowLogin(false)}>
              <div className="bg-slate-900 p-6 rounded-2xl border border-slate-700 w-full max-w-md" onClick={(e)=>e.stopPropagation()}>
                <div className="flex justify-center mb-4"><Lock className="w-8 h-8 text-amber-400" /></div>
                <h3 className="text-xl font-bold text-center mb-4">Admin Access</h3>
                <input type="password" value={loginCode} onChange={e=>setLoginCode(e.target.value)} onKeyDown={e=>e.key==='Enter' && handleAccessCodeLogin()} placeholder="Enter access code" className="w-full bg-slate-800 p-3 rounded mb-4" />
                <div className="flex gap-3">
                  <button onClick={()=>setShowLogin(false)} className="flex-1 text-slate-400">Cancel</button>
                  <button onClick={handleAccessCodeLogin} className="flex-1 bg-amber-400 text-slate-900 rounded">Unlock</button>
                </div>
                <p className="text-xs text-slate-500 mt-3">Press-and-hold the cart icon to open this access dialog.</p>
              </div>
            </div>
          )}

          {/* UPLOAD / EDIT modal */}
          {showUploadModal && (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4 overflow-auto">
              <div className="bg-slate-900 p-6 rounded-2xl w-full max-w-2xl border border-slate-700" onClick={(e)=>e.stopPropagation()}>
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-xl font-bold">{editingProduct ? 'Edit Product' : 'Upload New Product'}</h3>
                  <div className="flex items-center gap-2">
                    <button onClick={() => { setShowUploadModal(false); setEditingProduct(null); }} aria-label="Close"><X /></button>
                    <button onClick={handleSignOut} className="text-xs text-slate-400">Sign out</button>
                  </div>
                </div>

                <form onSubmit={handleSaveProduct} className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="md:col-span-2">
                    <label className="text-xs font-bold text-slate-400 uppercase mb-2 block">Product Photos (Max 8)</label>
                    <div className="grid grid-cols-4 gap-2 mb-2">
                      {formData.images.map((img, idx) => (
                        <div key={idx} className="aspect-square relative rounded overflow-hidden border">
                          <img src={typeof img === 'string' ? img : (img.url || '')} alt={`Preview ${idx+1}`} className="w-full h-full object-cover" />
                          <button type="button" onClick={()=>removeImage(idx)} className="absolute top-1 right-1 bg-red-500 p-1 rounded text-white"><X className="w-3 h-3" /></button>
                        </div>
                      ))}
                      {formData.images.length < 8 && (
                        <button type="button" onClick={()=>fileInputRef.current.click()} className="aspect-square flex items-center justify-center border-2 border-dashed rounded">
                          <Upload /> <span className="text-xs ml-2">Add</span>
                        </button>
                      )}
                    </div>
                    <input type="file" ref={fileInputRef} onChange={handleImageUpload} accept="image/*" multiple className="hidden" />
                  </div>

                  <div className="md:col-span-2">
                    <label className="text-xs text-slate-400 uppercase block mb-1">Product Name</label>
                    <input required value={formData.name} onChange={e=>setFormData({...formData,name:e.target.value})} className="w-full bg-slate-800 p-3 rounded" placeholder="e.g. iPhone 16 Pro Max" />
                  </div>

                  <div>
                    <label className="text-xs text-slate-400 uppercase block mb-1">Category</label>
                    <select value={formData.category} onChange={e=>setFormData({...formData,category:e.target.value})} className="w-full bg-slate-800 p-3 rounded">
                      {['Cars','Phones','Laptops','Tablets','Watches'].map(c=><option key={c} value={c}>{c}</option>)}
                    </select>
                  </div>

                  <div>
                    <label className="text-xs text-slate-400 uppercase block mb-1">Brand</label>
                    <input required value={formData.brand} onChange={e=>setFormData({...formData,brand:e.target.value})} className="w-full bg-slate-800 p-3 rounded" placeholder="e.g. Apple" />
                  </div>

                  <div>
                    <label className="text-xs text-slate-400 uppercase block mb-1">Selling Price ({NAIRA})</label>
                    <input required type="number" value={formData.price} onChange={e=>setFormData({...formData,price:e.target.value})} className="w-full bg-slate-800 p-3 rounded" />
                  </div>

                  <div>
                    <label className="text-xs text-slate-400 uppercase block mb-1">Old Price (optional)</label>
                    <input type="number" value={formData.oldPrice} onChange={e=>setFormData({...formData,oldPrice:e.target.value})} className="w-full bg-slate-800 p-3 rounded" />
                  </div>

                  <div className="md:col-span-2">
                    <label className="text-xs text-slate-400 uppercase block mb-1">Description</label>
                    <textarea value={formData.description} onChange={e=>setFormData({...formData,description:e.target.value})} className="w-full bg-slate-800 p-3 rounded h-24"></textarea>
                  </div>

                  <button type="submit" className={`md:col-span-2 bg-amber-400 text-slate-900 py-3 rounded font-bold ${isSaving ? 'btn-disabled' : ''}`} disabled={isSaving}>
                    {isSaving ? 'Posting...' : (editingProduct ? 'Update Inventory' : 'Post to Catalog')}
                  </button>
                </form>
              </div>
            </div>
          )}

          {/* FOOTER */}
          <footer className="bg-slate-900 border-t border-slate-800 py-12 mt-12">
            <div className="max-w-7xl mx-auto px-4 text-center">
              <div className="text-2xl font-bold">AFRINETHUB GLOBAL</div>
              <div className="text-slate-400 mt-2">Direct High-End Deals â€¢ Based in Nigeria</div>
              <div className="flex gap-4 justify-center mt-4">
                <button className="p-2 bg-slate-800 rounded"><svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8A8.5 8.5 0 1 1 11.5 3"/></svg></button>
                <button onClick={()=>window.open(`https://wa.me/${OFFICIAL_WHATSAPP}`,'_blank')} className="p-2 bg-slate-800 rounded text-green-400"><MessageCircle /></button>
              </div>
            </div>
          </footer>
        </div>
      );
    }

    // Mount
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>

  <!--
    Notes:
    - Behavior now:
      - Cart icon is always shown to visitors.
      - Admin features are only visible when the session flag isAdminActive === true.
      - To activate admin session: press-and-hold the cart icon (~700ms) -> Access Code modal opens -> enter code -> session becomes active and the Upload modal opens.
      - isAdminAllowed (stored in localStorage) merely remembers the device is permitted; it no longer auto-opens admin UI on page load. You must long-press + enter the code to activate a session.
    - Admin actions (save/delete) now check isAdminActive (session) â€” persistent localStorage alone is not sufficient to perform writes.
    - If you'd like "forget this device" behavior, we can add a button that clears localStorage key 'afri_is_admin'.
    - If you want the access code hidden, we can switch to hashed access-code (recommended) next.
  -->
</body>
</html>